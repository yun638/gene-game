<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§„ë¯¹ìŠ¤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 800px;
        }
        .top-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        .top-buttons button {
            padding: 8px 16px;
            font-size: 14px;
        }
        .character-display {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 20px auto;
            border: 3px solid #333;
            border-radius: 10px;
            background: #fff;
        }
        .part-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
        }
        .body { z-index: 1; }
        .head { z-index: 2; }
        .eyes { z-index: 3; }
        .my-character-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #e8f5e9;
            border-radius: 10px;
        }
        .characters-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        .character-box {
            text-align: center;
        }
        .heart-emoji {
            font-size: 48px;
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1); }
        }
        .selected-partner-box {
            text-align: center;
        }
        .selected-partner-display {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 20px auto;
            border: 3px dashed #ff4081;
            border-radius: 10px;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .empty-partner {
            color: #999;
            font-size: 14px;
            text-align: center;
        }
        .name-display {
            font-size: 24px;
            font-weight: bold;
            color: #2e7d32;
            margin: 10px 0;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
        }
        .name-display:hover {
            background: #c8e6c9;
        }
        .info {
            margin: 10px 0;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
            text-align: center;
        }
        .partners-section {
            margin-top: 30px;
        }
        .partners-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .partner-card {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        .partner-card:hover {
            border-color: #4CAF50;
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .partner-card.selected {
            border-color: #ff4081;
            background: #fce4ec;
        }
        .partner-display {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 10px auto;
            border: 2px solid #666;
            border-radius: 5px;
            background: #fff;
        }
        .partner-display .part-layer {
            font-size: 30px;
        }
        button {
            padding: 12px 24px;
            margin: 10px 5px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .breed-button {
            background-color: #ff4081;
            font-size: 18px;
            padding: 15px 30px;
        }
        .breed-button:hover {
            background-color: #f50057;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }
        .modal-close:hover {
            color: #000;
        }
        .family-tree {
            margin-top: 20px;
        }
        .tree-node {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        .tree-node-current {
            border-left-color: #ff4081;
            background: #fce4ec;
        }
        .tree-character {
            display: inline-block;
            position: relative;
            width: 60px;
            height: 60px;
            margin: 5px;
            border: 2px solid #666;
            border-radius: 5px;
            background: #fff;
            vertical-align: middle;
        }
        .tree-character .part-layer {
            font-size: 20px;
        }
        input[type="text"] {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 5px;
            width: 100%;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-buttons">
            <button onclick="showFamilyTree()">ğŸŒ³ ê°€ê³„ë„ ë³´ê¸°</button>
            <button onclick="saveGame()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
            <button onclick="loadGame()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>

        <h1>ğŸ’• ì§„ë¯¹ìŠ¤</h1>
        
        <div class="my-character-section">
            <h2>ë‚´ ìºë¦­í„°</h2>
            <div class="name-display" onclick="changeName()" id="nameDisplay">ì´ë¦„ ì—†ìŒ</div>
            <div style="font-size: 12px; color: #666; margin-bottom: 10px;">(í´ë¦­í•´ì„œ ì´ë¦„ ë³€ê²½)</div>
            
            <div class="characters-row">
                <div class="character-box">
                    <div class="character-display" id="myCharacter">
                        <div class="part-layer body" id="myBodyPart"></div>
                        <div class="part-layer head" id="myHeadPart"></div>
                        <div class="part-layer eyes" id="myEyesPart"></div>
                    </div>
                </div>
                
                <div class="heart-emoji">ğŸ’•</div>
                
                <div class="selected-partner-box">
                    <div class="selected-partner-display" id="selectedPartnerDisplay">
                        <div class="empty-partner">
                            â¬‡ï¸ ì•„ë˜ì—ì„œ<br>ë°°ìš°ìë¥¼ ì„ íƒí•˜ì„¸ìš”
                        </div>
                    </div>
                    <div style="font-size: 14px; color: #666; margin-top: 10px;">
                        <strong id="selectedPartnerLabel">ë°°ìš°ì ë¯¸ì„ íƒ</strong>
                    </div>
                </div>
            </div>
            
            <div class="info">
                <strong>ì„¸ëŒ€:</strong> <span id="generation">1</span>
            </div>
        </div>

        <div class="partners-section">
            <h2>ğŸ’ ë°°ìš°ì í›„ë³´ ì„ íƒ</h2>
            <button onclick="generatePartners()">ğŸ”„ ìƒˆë¡œìš´ í›„ë³´ ë³´ê¸°</button>
            
            <div class="partners-grid" id="partnersGrid"></div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="breed-button" onclick="breed()" id="breedButton" disabled>
                    ğŸ‘¶ ì„ íƒí•œ ë°°ìš°ìì™€ êµë°°í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- ê°€ê³„ë„ ëª¨ë‹¬ -->
    <div id="familyTreeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('familyTreeModal')">&times;</span>
            <h2>ğŸŒ³ ê°€ê³„ë„</h2>
            <div id="familyTreeContent"></div>
        </div>
    </div>

    <script>
        // ìœ ì „ì ì˜µì…˜ ì •ì˜
        // ì´ë¯¸ì§€ ê²½ë¡œ (GitHubì— ì˜¬ë¦° í›„ ì „ì²´ URLë¡œ ë³€ê²½ ê°€ëŠ¥)
        const GENES = {
            body: ['images/body_0.png', 'images/body_1.png', 'images/body_2.png', 'images/body_3.png'],
            head: ['images/head_0.png', 'images/head_1.png', 'images/head_2.png', 'images/head_3.png'],
            eyes: ['images/eyes_0.png', 'images/eyes_1.png', 'images/eyes_2.png', 'images/eyes_3.png']
        };

        // ìƒ‰ìƒ ì˜µì…˜ (ëª¸í†µê³¼ ë¨¸ë¦¬ëŠ” í•­ìƒ ê°™ì€ ìƒ‰)
        const COLORS = [
            'brightness(1.2) saturate(0.6) hue-rotate(-10deg)',     // 0: ì—°í•œ í•‘í¬ (#ffd2d2 ëŠë‚Œ)
            'brightness(1.1) saturate(0.7) hue-rotate(110deg)',     // 1: ì—°í•œ ì´ˆë¡ (#c1e2bd ëŠë‚Œ)
            'brightness(1.15) saturate(0.65) hue-rotate(200deg)'    // 2: ì—°í•œ íŒŒë‘ (#bcdff1 ëŠë‚Œ)
        ];

        const COLOR_NAMES = ['í•‘í¬', 'ë¯¼íŠ¸', 'ìŠ¤ì¹´ì´'];

        // ê²Œì„ ìƒíƒœ
        let myGenes = {
            body: Math.floor(Math.random() * GENES.body.length),
            head: Math.floor(Math.random() * GENES.head.length),
            eyes: Math.floor(Math.random() * GENES.eyes.length),
            color: Math.floor(Math.random() * COLORS.length) // ëª¸í†µê³¼ ë¨¸ë¦¬ ê³µí†µ ìƒ‰ìƒ
        };

        let myName = "ì´ë¦„ ì—†ìŒ";
        let partners = [];
        let selectedPartnerIndex = null;
        let generation = 1;
        let familyTree = [];

        // ì´ˆê¸° ê°€ê³„ë„ì— ì²« ìºë¦­í„° ì¶”ê°€
        familyTree.push({
            name: myName,
            genes: {...myGenes},
            generation: 1,
            parents: null
        });

        // ì´ˆê¸°í™”
        displayMyCharacter();
        generatePartners();

        // ë‚´ ìºë¦­í„° í‘œì‹œ
        function displayMyCharacter() {
            document.getElementById('myBodyPart').innerHTML = `<img src="${GENES.body[myGenes.body]}" style="width: 100%; height: 100%; object-fit: contain; filter: ${COLORS[myGenes.color]};">`;
            document.getElementById('myHeadPart').innerHTML = `<img src="${GENES.head[myGenes.head]}" style="width: 100%; height: 100%; object-fit: contain; filter: ${COLORS[myGenes.color]};">`;
            document.getElementById('myEyesPart').innerHTML = `<img src="${GENES.eyes[myGenes.eyes]}" style="width: 100%; height: 100%; object-fit: contain;">`;
            document.getElementById('nameDisplay').textContent = myName;
        }

        // ì´ë¦„ ë³€ê²½
        function changeName() {
            const newName = prompt("ìºë¦­í„°ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", myName);
            if (newName && newName.trim() !== "") {
                myName = newName.trim();
                familyTree[familyTree.length - 1].name = myName;
                displayMyCharacter();
            }
        }

        // ëœë¤ ìœ ì „ì ìƒì„±
        function randomGenes() {
            return {
                body: Math.floor(Math.random() * GENES.body.length),
                head: Math.floor(Math.random() * GENES.head.length),
                eyes: Math.floor(Math.random() * GENES.eyes.length),
                color: Math.floor(Math.random() * COLORS.length)
            };
        }

        // ë°°ìš°ì í›„ë³´ë“¤ ìƒì„±
        function generatePartners() {
            partners = [];
            for (let i = 0; i < 6; i++) {
                partners.push(randomGenes());
            }
            selectedPartnerIndex = null;
            document.getElementById('breedButton').disabled = true;
            
            // ì˜¤ë¥¸ìª½ ë°•ìŠ¤ ì´ˆê¸°í™”
            document.getElementById('selectedPartnerDisplay').innerHTML = `
                <div class="empty-partner">
                    â¬‡ï¸ ì•„ë˜ì—ì„œ<br>ë°°ìš°ìë¥¼ ì„ íƒí•˜ì„¸ìš”
                </div>
            `;
            document.getElementById('selectedPartnerLabel').textContent = 'ë°°ìš°ì ë¯¸ì„ íƒ';
            
            displayPartners();
        }

        // ìºë¦­í„° HTML ìƒì„± í•¨ìˆ˜
        function getCharacterHTML(genes, size = 'normal') {
            const sizeStyle = size === 'small' ? 'font-size: 20px;' : '';
            return `
                <div class="part-layer body"><img src="${GENES.body[genes.body]}" style="width: 100%; height: 100%; object-fit: contain; filter: ${COLORS[genes.color]};"></div>
                <div class="part-layer head"><img src="${GENES.head[genes.head]}" style="width: 100%; height: 100%; object-fit: contain; filter: ${COLORS[genes.color]};"></div>
                <div class="part-layer eyes"><img src="${GENES.eyes[genes.eyes]}" style="width: 100%; height: 100%; object-fit: contain;"></div>
            `;
        }

        // ë°°ìš°ì í›„ë³´ë“¤ í™”ë©´ì— í‘œì‹œ
        function displayPartners() {
            const grid = document.getElementById('partnersGrid');
            grid.innerHTML = '';
            
            partners.forEach((partnerGenes, index) => {
                const card = document.createElement('div');
                card.className = 'partner-card';
                if (selectedPartnerIndex === index) {
                    card.className += ' selected';
                }
                
                card.onclick = () => selectPartner(index);
                
                card.innerHTML = `
                    <div class="partner-display">
                        ${getCharacterHTML(partnerGenes, 'small')}
                    </div>
                    <div style="font-size: 12px; color: #666;">
                        í›„ë³´ ${index + 1}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // ë°°ìš°ì ì„ íƒ
        function selectPartner(index) {
            selectedPartnerIndex = index;
            document.getElementById('breedButton').disabled = false;
            
            // ì„ íƒëœ ë°°ìš°ìë¥¼ ì˜¤ë¥¸ìª½ ë°•ìŠ¤ì— í‘œì‹œ
            const partnerGenes = partners[index];
            const displayDiv = document.getElementById('selectedPartnerDisplay');
            displayDiv.innerHTML = getCharacterHTML(partnerGenes, 'normal');
            
            document.getElementById('selectedPartnerLabel').textContent = `í›„ë³´ ${index + 1} ì„ íƒë¨`;
            
            displayPartners();
        }

        // êµë°°
        function breed() {
            if (selectedPartnerIndex === null) {
                alert('ë°°ìš°ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            const partnerGenes = partners[selectedPartnerIndex];
            const parentName = myName;
            const parentGenes = {...myGenes};
            
            // ì¡°ë¶€ëª¨ì™€ ì¦ì¡°ë¶€ëª¨ ìœ ì „ì ê°€ì ¸ì˜¤ê¸°
            const currentFamily = familyTree[familyTree.length - 1];
            const grandparents = currentFamily.parents ? [
                currentFamily.parents.parent1.genes,
                currentFamily.parents.parent2.genes
            ] : null;
            
            let greatGrandparents = null;
            if (familyTree.length >= 2) {
                const parentGeneration = familyTree[familyTree.length - 2];
                if (parentGeneration.parents) {
                    greatGrandparents = [
                        parentGeneration.parents.parent1.genes,
                        parentGeneration.parents.parent2.genes
                    ];
                }
            }
            
            // ê° íŒŒì¸ ë³„ë¡œ ìœ ì „ ê²°ì •
            const childGenes = {
                body: 0,
                head: 0,
                eyes: 0,
                color: 0
            };
            
            const inheritanceMessages = [];
            const parts = ['body', 'head', 'eyes', 'color'];
            
            parts.forEach(part => {
                const rand = Math.random() * 100;
                
                if (rand < 88) {
                    // 88% ë¶€ëª¨
                    childGenes[part] = Math.random() < 0.5 ? myGenes[part] : partnerGenes[part];
                } else if (rand < 94 && grandparents) {
                    // 6% ì¡°ë¶€ëª¨
                    const grandparent = grandparents[Math.floor(Math.random() * grandparents.length)];
                    childGenes[part] = grandparent[part];
                    if (part === 'color') {
                        inheritanceMessages.push('ğŸ¨ ì¡°ë¶€ëª¨ì˜ ìƒ‰ìƒ ìœ ì „!');
                    } else {
                        inheritanceMessages.push(`ğŸ‘´ğŸ‘µ ì¡°ë¶€ëª¨ì˜ ${part === 'body' ? 'ëª¸í†µ' : part === 'head' ? 'ë¨¸ë¦¬' : 'ëˆˆ'} ìœ ì „!`);
                    }
                } else if (rand < 96 && greatGrandparents) {
                    // 2% ì¦ì¡°ë¶€ëª¨
                    const greatGrandparent = greatGrandparents[Math.floor(Math.random() * greatGrandparents.length)];
                    childGenes[part] = greatGrandparent[part];
                    if (part === 'color') {
                        inheritanceMessages.push('ğŸ¨ ì¦ì¡°ë¶€ëª¨ì˜ ìƒ‰ìƒ ìœ ì „!');
                    } else {
                        inheritanceMessages.push(`ğŸ‘µğŸ‘´ ì¦ì¡°ë¶€ëª¨ì˜ ${part === 'body' ? 'ëª¸í†µ' : part === 'head' ? 'ë¨¸ë¦¬' : 'ëˆˆ'} ìœ ì „!`);
                    }
                } else {
                    // 4% ëŒì—°ë³€ì´ (ë˜ëŠ” ì¡°ë¶€ëª¨/ì¦ì¡°ë¶€ëª¨ ì—†ì„ ë•Œ)
                    if (part === 'color') {
                        childGenes[part] = Math.floor(Math.random() * COLORS.length);
                    } else {
                        childGenes[part] = Math.floor(Math.random() * GENES[part].length);
                    }
                    inheritanceMessages.push(`âœ¨ ${part === 'color' ? 'ìƒ‰ìƒ' : part === 'body' ? 'ëª¸í†µ' : part === 'head' ? 'ë¨¸ë¦¬' : 'ëˆˆ'} ëŒì—°ë³€ì´!`);
                }
            });

            // ìì‹ì´ ìƒˆë¡œìš´ ë‚´ ìºë¦­í„°ê°€ ë¨
            myGenes = childGenes;
            generation++;
            myName = "ì•„ê°€";
            
            // ê°€ê³„ë„ì— ì¶”ê°€
            familyTree.push({
                name: myName,
                genes: {...childGenes},
                generation: generation,
                parents: {
                    parent1: {name: parentName, genes: parentGenes},
                    parent2: {name: "ë°°ìš°ì", genes: partnerGenes}
                }
            });
            
            document.getElementById('generation').textContent = generation;
            displayMyCharacter();
            
            // ìƒˆë¡œìš´ ë°°ìš°ì í›„ë³´ ìƒì„±
            generatePartners();
            
            // ìœ ì „ ë©”ì‹œì§€ í‘œì‹œ
            if (inheritanceMessages.length > 0) {
                const uniqueMessages = [...new Set(inheritanceMessages)];
                alert(uniqueMessages.join('\n'));
            }
        }

        // ê°€ê³„ë„ í‘œì‹œ
        function showFamilyTree() {
            const content = document.getElementById('familyTreeContent');
            content.innerHTML = '';
            
            if (familyTree.length === 0) {
                content.innerHTML = '<p>ì•„ì§ ê°€ê³„ë„ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                familyTree.forEach((member, index) => {
                    const isCurrentGen = (index === familyTree.length - 1);
                    const nodeDiv = document.createElement('div');
                    nodeDiv.className = isCurrentGen ? 'tree-node tree-node-current' : 'tree-node';
                    
                    let html = `
                        <strong>${member.generation}ì„¸ëŒ€: ${member.name}</strong>
                        ${isCurrentGen ? ' (í˜„ì¬)' : ''}
                        <br>
                        <div class="tree-character">
                            ${getCharacterHTML(member.genes, 'small')}
                        </div>
                        <span style="font-size: 12px; color: #666;">
                            ìƒ‰ìƒ: ${COLOR_NAMES[member.genes.color]} | 
                            ëª¸í†µ: íƒ€ì…${member.genes.body} | 
                            ë¨¸ë¦¬: íƒ€ì…${member.genes.head} | 
                            ëˆˆ: íƒ€ì…${member.genes.eyes}
                        </span>
                    `;
                    
                    if (member.parents) {
                        html += `
                            <br><br>
                            <div style="font-size: 14px; color: #666;">
                                <strong>ë¶€ëª¨:</strong><br>
                                <div style="display: inline-block; margin: 5px;">
                                    ${member.parents.parent1.name}
                                    <div class="tree-character">
                                        ${getCharacterHTML(member.parents.parent1.genes, 'small')}
                                    </div>
                                </div>
                                +
                                <div style="display: inline-block; margin: 5px;">
                                    ${member.parents.parent2.name}
                                    <div class="tree-character">
                                        ${getCharacterHTML(member.parents.parent2.genes, 'small')}
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    nodeDiv.innerHTML = html;
                    content.appendChild(nodeDiv);
                });
            }
            
            document.getElementById('familyTreeModal').style.display = 'block';
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // ê²Œì„ ì €ì¥
        function saveGame() {
            const gameData = {
                myGenes: myGenes,
                myName: myName,
                generation: generation,
                familyTree: familyTree
            };
            
            const jsonData = JSON.stringify(gameData);
            const blob = new Blob([jsonData], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ì§„ë¯¹ìŠ¤_${myName}_ì„¸ëŒ€${generation}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('ê²Œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ê²Œì„ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadGame() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const gameData = JSON.parse(event.target.result);
                        
                        myGenes = gameData.myGenes;
                        myName = gameData.myName;
                        generation = gameData.generation;
                        familyTree = gameData.familyTree;
                        
                        document.getElementById('generation').textContent = generation;
                        displayMyCharacter();
                        generatePartners();
                        
                        alert('ê²Œì„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
                    } catch (error) {
                        alert('íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }
    </script>
</body>
</html>
